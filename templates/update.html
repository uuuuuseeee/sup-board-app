<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ボード情報の更新</title>
</head>
<body>
    <h1>ボード情報の更新</h1>
    <form action="/update/{{ board.id }}" method="POST">
        <p>
            ボード名: <input type="text" name="name" value="{{ board.name }}" required>
        </p>
        <p>
            場所: 
            <select name="location_select" id="location_select" onchange="toggleLocationInput()">
                {% set standard_locations = ['横浜', '海の公園', '平塚', '日本橋'] %}
                {% for loc in standard_locations %}
                    <option value="{{ loc }}" {% if board.location == loc %}selected{% endif %}>{{ loc }}</option>
                {% endfor %}
                <option value="その他" {% if board.location not in standard_locations %}selected{% endif %}>その他</option>
            </select>
        </p>
        
        <p id="location_other_p" style="display: none;">
            具体的な場所: <input type="text" name="location_other" value="{% if board.location not in standard_locations %}{{ board.location }}{% endif %}">
        </p>

        <p id="updater_p">
            更新者: <input type="text" name="updater" value="{{ board.user }}">
        </p>

        <p id="owner_p" style="display: none;">
            持ち主: <input type="text" name="owner" value="{{ board.user }}">
        </p>

        <p>
            備考: <br>
            <textarea name="notes" rows="4" cols="50">{{ board.notes or '' }}</textarea>
        </p>
        <button type="submit">更新する</button>
    </form>
    <br>
    <a href="/">一覧に戻る</a>

    <script>
        function toggleLocationInput() {
            const select = document.getElementById('location_select');
            const otherLocationP = document.getElementById('location_other_p');
            const updaterP = document.getElementById('updater_p');
            const ownerP = document.getElementById('owner_p');
            const isOther = select.value === 'その他';

            otherLocationP.style.display = isOther ? 'block' : 'none';
            ownerP.style.display = isOther ? 'block' : 'none';
            updaterP.style.display = isOther ? 'none' : 'block';

            // 必須(required)属性の切り替え
            if (isOther) {
                updaterP.querySelector('input').removeAttribute('required');
                ownerP.querySelector('input').setAttribute('required', 'required');
            } else {
                ownerP.querySelector('input').removeAttribute('required');
                updaterP.querySelector('input').setAttribute('required', 'required');
            }
        }
        // ページが読み込まれた時に、現在のデータに合わせてフォームの状態を正しく設定する
        document.addEventListener('DOMContentLoaded', toggleLocationInput);
    </script>
</body>
</html>